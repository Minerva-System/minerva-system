FROM rust:1.61.0 AS chef
WORKDIR /
RUN apt update && apt install -y cmake
RUN cargo install cargo-chef

# NOTE: Execute this in the root folder of the project!
FROM chef AS planner
RUN mkdir /minerva
WORKDIR /minerva
ADD . .
RUN cargo chef prepare --recipe-path recipe.json

FROM chef
COPY --from=planner /minerva/recipe.json recipe.json
RUN cargo chef cook --release --recipe-path recipe.json

