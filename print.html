<!DOCTYPE HTML>
<html lang="pt-br" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Sistema Minerva</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introdução</a></li><li class="chapter-item expanded "><a href="estrutura.html"><strong aria-hidden="true">2.</strong> Estrutura geral do projeto</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="backend.html"><strong aria-hidden="true">2.1.</strong> Back-End</a></li></ol></li><li class="chapter-item expanded "><a href="multi-tenancy.html"><strong aria-hidden="true">3.</strong> Multi-Tenancy</a></li><li class="chapter-item expanded "><a href="compilacao.html"><strong aria-hidden="true">4.</strong> Compilação</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="executar-maquina.html"><strong aria-hidden="true">4.1.</strong> Executar com recursos da máquina</a></li><li class="chapter-item expanded "><a href="deploy-compose.html"><strong aria-hidden="true">4.2.</strong> Deploy via Docker Compose</a></li><li class="chapter-item expanded "><a href="deploy-kubernetes.html"><strong aria-hidden="true">4.3.</strong> Deploy via Kubernetes</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Sistema Minerva</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introdução"><a class="header" href="#introdução">Introdução</a></h1>
<p><img src="./minerva-logo.png" alt="Logomarca do Sistema Minerva" /></p>
<p>Este documento trata da especificação funcional do Sistema Minerva. O sistema
é majoritariamente programado utilizando o método eXtreme Programming, portanto
esta documentação não é exaustiva no sentido de uma especificação completa,
posto que os requisitos do sistema estarão em constante mudança.</p>
<p>A modificação deste documento é enormemente encorajada, mas é mais importante a
prototipação constante do sistema que a escrita da especificação propriamente
dita.</p>
<p>Para mitigar os problemas que podem ocorrer mediante foco diminuído neste
documento, recomenda-se um grande uso de testes unitários e também de documentação
<em>ad-hoc</em> no código dos módulos do projeto, de preferência envolvendo as ferramentas
padrão da linguagem.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="estrutura-geral-do-projeto"><a class="header" href="#estrutura-geral-do-projeto">Estrutura geral do projeto</a></h1>
<p>O projeto Minerva é uma aplicação pensada com finalidade de estudo, mas que
não deixa de ser um sistema real e com um público alvo. Sendo assim, trata-se
de um sistema gerencial pensado para pequenos negócios, <em>sem finalidade comercial</em>.</p>
<p>O projeto envolve um licenciamento de Software Livre, e busca implementar uma
estrutura de microsserviços. Em outras palavras, o sistema opera através da modificação
de uma única base de dados, mas possui modulos separados para modificação de partes
específicas.</p>
<p>Minerva também utiliza uma dicotomia front-end/back-end, de forma que a aplicação
constitui-se de uma interface gráfica web, acessível via navegador, e uma intraestrutura
constituída de um ponto de entrada que se comunica com os serviços específicos que
a interface gráfica requisitar.</p>
<h2 id="serviços"><a class="header" href="#serviços">Serviços</a></h2>
<p>Como supracitado, Minerva constitui-se de microsserviços, especialmente em seu back-end.
Para tanto, deve-se pensar em três grandes serviços:</p>
<ul>
<li>Front-End (aplicação web envolvendo interface gráfica, feita em alguma tecnologia
para tal, como Flutter);</li>
<li>Back-End (aplicação com ponto de entrada REST, constituída de microsserviços, com
comunicação interna via gRPC);</li>
<li>Banco de Dados (PostgreSQL 14, que pode ser utilizado em um contêiner Docker para
intuitos de debug apenas).</li>
</ul>
<p>Adicionalmente, será possível manter uma maleabilidade que permita a confecção de outros
tipos de Front-Ends que se comuniquem diretamente com o Back-End da aplicação, como
por exemplo, através de programas nativos para Desktop e Mobile.</p>
<div><!-- Generated by graphviz version 2.43.0 (0)
 --><!-- Title: %3 Pages: 1 --><svg width="407pt" height="228pt"
 viewBox="0.00 0.00 407.00 228.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 224)"><title>%3</title><polygon fill="white" stroke="transparent" points="-4,4 -4,-224 403,-224 403,4 -4,4"/><g id="clust2" class="cluster"><title>cluster_webservice</title><polygon fill="none" stroke="black" points="8,-98 8,-212 391,-212 391,-98 8,-98"/><text text-anchor="middle" x="199.5" y="-196.8" font-family="Times,serif" font-size="14.00">Serviço Web</text></g><g id="clust3" class="cluster"><title>cluster_internal</title><polygon fill="none" stroke="black" points="193,-106 193,-181 383,-181 383,-106 193,-106"/><text text-anchor="middle" x="288" y="-165.8" font-family="Times,serif" font-size="14.00">Interno</text></g><!-- frontend --><g id="node1" class="node"><title>frontend</title><polygon fill="none" stroke="black" points="145,-150 16,-150 16,-114 151,-114 151,-144 145,-150"/><polyline fill="none" stroke="black" points="145,-150 145,-144 "/><polyline fill="none" stroke="black" points="151,-144 145,-144 "/><text text-anchor="middle" x="83.5" y="-128.3" font-family="Times,serif" font-size="14.00">Front&#45;End (Web)</text></g><!-- backend --><g id="node2" class="node"><title>backend</title><polygon fill="none" stroke="black" points="285,-150 205,-150 201,-146 201,-114 281,-114 285,-118 285,-150"/><polyline fill="none" stroke="black" points="281,-146 201,-146 "/><polyline fill="none" stroke="black" points="281,-146 281,-114 "/><polyline fill="none" stroke="black" points="281,-146 285,-150 "/><text text-anchor="middle" x="243" y="-128.3" font-family="Times,serif" font-size="14.00">Back&#45;End</text></g><!-- frontend&#45;&gt;backend --><g id="edge3" class="edge"><title>frontend&#45;&gt;backend</title><path fill="none" stroke="black" d="M151.29,-138.68C164.39,-138.83 177.95,-138.73 190.45,-138.38"/><polygon fill="black" stroke="black" points="190.81,-141.87 200.68,-138.02 190.57,-134.87 190.81,-141.87"/></g><!-- backend&#45;&gt;frontend --><g id="edge4" class="edge"><title>backend&#45;&gt;frontend</title><path fill="none" stroke="black" d="M200.68,-125.98C188.64,-125.47 175.08,-125.23 161.58,-125.25"/><polygon fill="black" stroke="black" points="161.27,-121.75 151.29,-125.32 161.32,-128.75 161.27,-121.75"/></g><!-- db --><g id="node3" class="node"><title>db</title><path fill="none" stroke="black" d="M375,-146.73C375,-148.53 362.9,-150 348,-150 333.1,-150 321,-148.53 321,-146.73 321,-146.73 321,-117.27 321,-117.27 321,-115.47 333.1,-114 348,-114 362.9,-114 375,-115.47 375,-117.27 375,-117.27 375,-146.73 375,-146.73"/><path fill="none" stroke="black" d="M375,-146.73C375,-144.92 362.9,-143.45 348,-143.45 333.1,-143.45 321,-144.92 321,-146.73"/><text text-anchor="middle" x="348" y="-128.3" font-family="Times,serif" font-size="14.00">BD</text></g><!-- backend&#45;&gt;db --><g id="edge5" class="edge"><title>backend&#45;&gt;db</title><path fill="none" stroke="black" d="M285,-125.38C293.52,-125.17 302.45,-125.22 310.78,-125.52"/><polygon fill="black" stroke="black" points="310.78,-129.03 320.95,-126.04 311.14,-122.04 310.78,-129.03"/></g><!-- db&#45;&gt;backend --><g id="edge6" class="edge"><title>db&#45;&gt;backend</title><path fill="none" stroke="black" d="M320.95,-137.96C313.03,-138.49 304.04,-138.76 295.07,-138.75"/><polygon fill="black" stroke="black" points="295.05,-135.25 285,-138.62 294.96,-142.25 295.05,-135.25"/></g><!-- desktop --><g id="node4" class="node"><title>desktop</title><polygon fill="none" stroke="black" points="165,-90 2,-90 2,-54 165,-54 165,-90"/><text text-anchor="middle" x="83.5" y="-68.3" font-family="Times,serif" font-size="14.00">Front&#45;End (Desktop)</text></g><!-- desktop&#45;&gt;backend --><g id="edge1" class="edge"><title>desktop&#45;&gt;backend</title><path fill="none" stroke="black" stroke-dasharray="1,5" d="M154.15,-90.13C157.84,-91.37 161.48,-92.66 165,-94 176.54,-98.38 188.67,-103.9 199.81,-109.37"/><polygon fill="black" stroke="black" points="198.38,-112.57 208.89,-113.92 201.52,-106.31 198.38,-112.57"/></g><!-- mobile --><g id="node5" class="node"><title>mobile</title><polygon fill="none" stroke="black" points="160,-36 7,-36 7,0 160,0 160,-36"/><text text-anchor="middle" x="83.5" y="-14.3" font-family="Times,serif" font-size="14.00">Front&#45;End (Mobile)</text></g><!-- mobile&#45;&gt;backend --><g id="edge2" class="edge"><title>mobile&#45;&gt;backend</title><path fill="none" stroke="black" stroke-dasharray="1,5" d="M148.8,-36.08C154.47,-38.7 159.96,-41.66 165,-45 189.06,-60.94 210.28,-86.24 224.32,-105.46"/><polygon fill="black" stroke="black" points="221.6,-107.68 230.25,-113.8 227.31,-103.62 221.6,-107.68"/></g></g></svg></div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="back-end"><a class="header" href="#back-end">Back-End</a></h1>
<p>O back-end Minerva compõe-se de microsserviços, com uma interface comum de
comunicação externa que seja simples de usar para os padrões atuais.</p>
<p>O back-end compõe-se dos seguintes componentes:</p>
<ol>
<li>Componente de comunicação externa: um serviço composto de rotas, sendo
portanto uma API REST. Este serviço requisita dados sob demanda a cada
serviço, dependendo do recurso que foi requisitado por via externa. É
efetivamente o intermediário entre Minerva e o mundo externo. As
requisições entre este serviço e os outros deverão ser feito através da
abertura de uma requisição gRPC em que este módulo seja o cliente
requisitante; as respostas recebidas via gRPC são então retornadas
como resposta às requisições recebidas via REST, após tratamento para
serialização como JSON.</li>
<li>Componente de usuários: Servidor gRPC responsável por realizar o CRUD
de usuários e por verificar as regras de negócio destas operações.</li>
<li>Componente de sessão: Servidor gRPC responsável por realizar login,
logoff, verificação de senha e gerenciamento de sessão de usuários.</li>
<li>Componente de produtos: Servidor gRPC responsável por realizar o CRUD
de produtos e por verificar as regras de negócio destas operações.</li>
<li>Componente de estoque: Servidor gRPC responsável por realizar regras
de negócios relacionadas a estoque de produtos (início, baixa, lançamento,
etc).</li>
</ol>
<p>Os <strong>serviços gRPC</strong> supracitados tratam-se de servidores gRPC que podem
receber conexões vindas do ponto de entrada REST ou mesmo entre si. Além
disso, os serviços gRPC devem ser capazes de se comunicar com bancos de
dados, que são recursos essenciais para os mesmos (exemplo: PostgreSQL,
Redis). Além disso, <strong>estes serviços devem gravar log de suas operações</strong>,
mais especificamente nas operações de inserção, atualização e exclusão.</p>
<p>Esses componentes possuem análogos programados, mas não são todos os módulos
da aplicação, que também constituem-se de bibliotecas que podem ser utilizadas
e referenciadas entre si.</p>
<div><!-- Generated by graphviz version 2.43.0 (0)
 --><!-- Title: %3 Pages: 1 --><svg width="590pt" height="393pt"
 viewBox="0.00 0.00 590.00 393.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 389)"><title>%3</title><polygon fill="white" stroke="transparent" points="-4,4 -4,-389 586,-389 586,4 -4,4"/><g id="clust1" class="cluster"><title>cluster_db</title><polygon fill="none" stroke="darkmagenta" points="174,-8 174,-98 388,-98 388,-8 174,-8"/><text text-anchor="middle" x="281" y="-82.8" font-family="Times,serif" font-size="14.00" fill="darkmagenta">BANCO DE DADOS</text><text text-anchor="middle" x="281" y="-67.8" font-family="Times,serif" font-size="14.00" fill="darkmagenta">(multi&#45;inquilino)</text></g><g id="clust3" class="cluster"><title>cluster_backend</title><polygon fill="none" stroke="darkred" points="8,-146 8,-308 574,-308 574,-146 8,-146"/><text text-anchor="middle" x="291" y="-292.8" font-family="Times,serif" font-size="14.00" fill="darkred">BACK&#45;END</text></g><!-- frontend --><g id="node1" class="node"><title>frontend</title><polygon fill="white" stroke="darkorange" points="275,-385 175,-385 175,-349 281,-349 281,-379 275,-385"/><polyline fill="none" stroke="darkorange" points="275,-385 275,-379 "/><polyline fill="none" stroke="darkorange" points="281,-379 275,-379 "/><text text-anchor="middle" x="228" y="-363.3" font-family="Times,serif" font-size="14.00" fill="darkorange">FRONT&#45;END</text></g><!-- rest --><g id="node5" class="node"><title>rest</title><polygon fill="white" stroke="black" points="256,-277 204,-277 200,-273 200,-241 252,-241 256,-245 256,-277"/><polyline fill="none" stroke="black" points="252,-273 200,-273 "/><polyline fill="none" stroke="black" points="252,-273 252,-241 "/><polyline fill="none" stroke="black" points="252,-273 256,-277 "/><text text-anchor="middle" x="228" y="-255.3" font-family="Times,serif" font-size="14.00">REST</text></g><!-- frontend&#45;&#45;rest --><g id="edge13" class="edge"><title>frontend&#45;&#45;rest</title><path fill="none" stroke="green" d="M228,-348.97C228,-329.31 228,-297.13 228,-277.34"/><text text-anchor="middle" x="248" y="-319.8" font-family="Times,serif" font-size="14.00" fill="green">REST</text></g><!-- db2 --><g id="node2" class="node"><title>db2</title><path fill="white" stroke="darkmagenta" d="M380,-48.73C380,-50.53 367.9,-52 353,-52 338.1,-52 326,-50.53 326,-48.73 326,-48.73 326,-19.27 326,-19.27 326,-17.47 338.1,-16 353,-16 367.9,-16 380,-17.47 380,-19.27 380,-19.27 380,-48.73 380,-48.73"/><path fill="none" stroke="darkmagenta" d="M380,-48.73C380,-46.92 367.9,-45.45 353,-45.45 338.1,-45.45 326,-46.92 326,-48.73"/><text text-anchor="middle" x="353" y="-30.3" font-family="Times,serif" font-size="14.00" fill="darkmagenta">inq3</text></g><!-- db1 --><g id="node3" class="node"><title>db1</title><path fill="white" stroke="darkmagenta" d="M308,-48.73C308,-50.53 295.9,-52 281,-52 266.1,-52 254,-50.53 254,-48.73 254,-48.73 254,-19.27 254,-19.27 254,-17.47 266.1,-16 281,-16 295.9,-16 308,-17.47 308,-19.27 308,-19.27 308,-48.73 308,-48.73"/><path fill="none" stroke="darkmagenta" d="M308,-48.73C308,-46.92 295.9,-45.45 281,-45.45 266.1,-45.45 254,-46.92 254,-48.73"/><text text-anchor="middle" x="281" y="-30.3" font-family="Times,serif" font-size="14.00" fill="darkmagenta">inq2</text></g><!-- db3 --><g id="node4" class="node"><title>db3</title><path fill="white" stroke="darkmagenta" d="M236,-48.73C236,-50.53 223.9,-52 209,-52 194.1,-52 182,-50.53 182,-48.73 182,-48.73 182,-19.27 182,-19.27 182,-17.47 194.1,-16 209,-16 223.9,-16 236,-17.47 236,-19.27 236,-19.27 236,-48.73 236,-48.73"/><path fill="none" stroke="darkmagenta" d="M236,-48.73C236,-46.92 223.9,-45.45 209,-45.45 194.1,-45.45 182,-46.92 182,-48.73"/><text text-anchor="middle" x="209" y="-30.3" font-family="Times,serif" font-size="14.00" fill="darkmagenta">inq1</text></g><!-- user --><g id="node6" class="node"><title>user</title><polygon fill="white" stroke="black" points="75.5,-190 20.5,-190 16.5,-186 16.5,-154 71.5,-154 75.5,-158 75.5,-190"/><polyline fill="none" stroke="black" points="71.5,-186 16.5,-186 "/><polyline fill="none" stroke="black" points="71.5,-186 71.5,-154 "/><polyline fill="none" stroke="black" points="71.5,-186 75.5,-190 "/><text text-anchor="middle" x="46" y="-168.3" font-family="Times,serif" font-size="14.00">USER</text></g><!-- rest&#45;&#45;user --><g id="edge1" class="edge"><title>rest&#45;&#45;user</title><path fill="none" stroke="blue" d="M199.96,-244.91C166.26,-229.16 109.96,-202.87 75.58,-186.82"/><text text-anchor="middle" x="167" y="-211.8" font-family="Times,serif" font-size="14.00" fill="blue">gRPC</text></g><!-- session --><g id="node7" class="node"><title>session</title><polygon fill="white" stroke="black" points="217,-190 137,-190 133,-186 133,-154 213,-154 217,-158 217,-190"/><polyline fill="none" stroke="black" points="213,-186 133,-186 "/><polyline fill="none" stroke="black" points="213,-186 213,-154 "/><polyline fill="none" stroke="black" points="213,-186 217,-190 "/><text text-anchor="middle" x="175" y="-168.3" font-family="Times,serif" font-size="14.00">SESSION</text></g><!-- rest&#45;&#45;session --><g id="edge2" class="edge"><title>rest&#45;&#45;session</title><path fill="none" stroke="blue" d="M217.27,-240.8C208.08,-226.05 194.9,-204.92 185.71,-190.18"/><text text-anchor="middle" x="224" y="-211.8" font-family="Times,serif" font-size="14.00" fill="blue">gRPC</text></g><!-- product --><g id="node8" class="node"><title>product</title><polygon fill="white" stroke="black" points="326.5,-190 239.5,-190 235.5,-186 235.5,-154 322.5,-154 326.5,-158 326.5,-190"/><polyline fill="none" stroke="black" points="322.5,-186 235.5,-186 "/><polyline fill="none" stroke="black" points="322.5,-186 322.5,-154 "/><polyline fill="none" stroke="black" points="322.5,-186 326.5,-190 "/><text text-anchor="middle" x="281" y="-168.3" font-family="Times,serif" font-size="14.00">PRODUCT</text></g><!-- rest&#45;&#45;product --><g id="edge3" class="edge"><title>rest&#45;&#45;product</title><path fill="none" stroke="blue" d="M238.73,-240.8C247.92,-226.05 261.1,-204.92 270.29,-190.18"/><text text-anchor="middle" x="277" y="-211.8" font-family="Times,serif" font-size="14.00" fill="blue">gRPC</text></g><!-- stock --><g id="node9" class="node"><title>stock</title><polygon fill="white" stroke="black" points="452,-190 388,-190 384,-186 384,-154 448,-154 452,-158 452,-190"/><polyline fill="none" stroke="black" points="448,-186 384,-186 "/><polyline fill="none" stroke="black" points="448,-186 448,-154 "/><polyline fill="none" stroke="black" points="448,-186 452,-190 "/><text text-anchor="middle" x="418" y="-168.3" font-family="Times,serif" font-size="14.00">STOCK</text></g><!-- rest&#45;&#45;stock --><g id="edge4" class="edge"><title>rest&#45;&#45;stock</title><path fill="none" stroke="blue" d="M256.04,-245.46C290,-230.26 347.19,-204.68 383.73,-188.33"/><text text-anchor="middle" x="354" y="-211.8" font-family="Times,serif" font-size="14.00" fill="blue">gRPC</text></g><!-- report --><g id="node11" class="node"><title>report</title><polygon fill="white" stroke="black" points="392,-277 318,-277 314,-273 314,-241 388,-241 392,-245 392,-277"/><polyline fill="none" stroke="black" points="388,-273 314,-273 "/><polyline fill="none" stroke="black" points="388,-273 388,-241 "/><polyline fill="none" stroke="black" points="388,-273 392,-277 "/><text text-anchor="middle" x="353" y="-255.3" font-family="Times,serif" font-size="14.00">REPORT</text></g><!-- rest&#45;&#45;report --><g id="edge7" class="edge"><title>rest&#45;&#45;report</title><path fill="none" stroke="blue" d="M256.05,-259C273.04,-259 294.96,-259 313.67,-259"/><text text-anchor="middle" x="285" y="-265.8" font-family="Times,serif" font-size="14.00" fill="blue">gRPC</text></g><!-- user&#45;&#45;db1 --><g id="edge8" class="edge"><title>user&#45;&#45;db1</title><path fill="none" stroke="darkmagenta" d="M69.54,-153.92C92.08,-138.54 127.63,-116.76 162,-106 179.68,-100.46 229.44,-108.06 245,-98"/><text text-anchor="middle" x="182.5" y="-124.8" font-family="Times,serif" font-size="14.00" fill="darkmagenta">DB</text><text text-anchor="middle" x="182.5" y="-109.8" font-family="Times,serif" font-size="14.00" fill="darkmagenta">(Pool)</text></g><!-- user&#45;&#45;session --><g id="edge5" class="edge"><title>user&#45;&#45;session</title><path fill="none" stroke="blue" d="M75.6,-172C92.56,-172 114.12,-172 132.83,-172"/><text text-anchor="middle" x="104.25" y="-178.8" font-family="Times,serif" font-size="14.00" fill="blue">gRPC</text></g><!-- session&#45;&#45;db1 --><g id="edge9" class="edge"><title>session&#45;&#45;db1</title><path fill="none" stroke="darkmagenta" d="M190.39,-153.76C202.49,-140.43 219.92,-121.65 236,-106 239.84,-102.27 241.63,-102.16 245,-98"/><text text-anchor="middle" x="256.5" y="-124.8" font-family="Times,serif" font-size="14.00" fill="darkmagenta">DB</text><text text-anchor="middle" x="256.5" y="-109.8" font-family="Times,serif" font-size="14.00" fill="darkmagenta">(Pool)</text></g><!-- product&#45;&#45;db1 --><g id="edge10" class="edge"><title>product&#45;&#45;db1</title><path fill="none" stroke="darkmagenta" d="M281,-153.78C281,-139.56 281,-118.48 281,-98"/><text text-anchor="middle" x="301.5" y="-124.8" font-family="Times,serif" font-size="14.00" fill="darkmagenta">DB</text><text text-anchor="middle" x="301.5" y="-109.8" font-family="Times,serif" font-size="14.00" fill="darkmagenta">(Pool)</text></g><!-- product&#45;&#45;stock --><g id="edge6" class="edge"><title>product&#45;&#45;stock</title><path fill="none" stroke="blue" d="M326.62,-172C345.3,-172 366.55,-172 383.85,-172"/><text text-anchor="middle" x="355.25" y="-178.8" font-family="Times,serif" font-size="14.00" fill="blue">gRPC</text></g><!-- stock&#45;&#45;db1 --><g id="edge11" class="edge"><title>stock&#45;&#45;db1</title><path fill="none" stroke="darkmagenta" d="M393.05,-153.79C365.17,-134.44 323.11,-104.8 317,-98"/><text text-anchor="middle" x="385.5" y="-124.8" font-family="Times,serif" font-size="14.00" fill="darkmagenta">DB</text><text text-anchor="middle" x="385.5" y="-109.8" font-family="Times,serif" font-size="14.00" fill="darkmagenta">(Pool)</text></g><!-- runonce --><g id="node10" class="node"><title>runonce</title><polygon fill="white" stroke="black" points="565.5,-190 474.5,-190 470.5,-186 470.5,-154 561.5,-154 565.5,-158 565.5,-190"/><polyline fill="none" stroke="black" points="561.5,-186 470.5,-186 "/><polyline fill="none" stroke="black" points="561.5,-186 561.5,-154 "/><polyline fill="none" stroke="black" points="561.5,-186 565.5,-190 "/><text text-anchor="middle" x="518" y="-168.3" font-family="Times,serif" font-size="14.00">RUNONCE</text></g><!-- runonce&#45;&#45;db1 --><g id="edge12" class="edge"><title>runonce&#45;&#45;db1</title><path fill="none" stroke="magenta" d="M496.3,-153.82C475.47,-138.37 442.47,-116.54 410,-106 390.27,-99.6 334.48,-109.17 317,-98"/><text text-anchor="middle" x="497" y="-124.8" font-family="Times,serif" font-size="14.00" fill="magenta">DB</text><text text-anchor="middle" x="497" y="-109.8" font-family="Times,serif" font-size="14.00" fill="magenta">(Avulsa)</text></g></g></svg></div>
<h2 id="bibliotecas"><a class="header" href="#bibliotecas">Bibliotecas</a></h2>
<p>As bibliotecas planejadas para o sistema são:</p>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
<code>minerva-rpc</code>: Implementação de protocolos gRPC e de mensagens destes
protocolo. Deve ser importado em todos os módulos, sendo essencial para
a criação de clientes e servidores gRPC. Os modelos de comunicação
implementados para si devem ser também convertidos para e
a partir dos DTOs do módulo de dados.</li>
<li><input disabled="" type="checkbox" checked=""/>
<code>minerva-data</code>: Implementação de utilitários de comunicação com banco de
dados (PostgreSQL) e objetos de transferência de dados (DTOs). Deve ser
importado em todos os módulos, exceto na comunicação REST. Os DTOs também
devem implementar traits e utilitários para conversão das mensagens
implementadas em <code>minerva-rpc</code> para os DTOs desta biblioteca.</li>
<li><input disabled="" type="checkbox"/>
<code>minerva-cache</code>: Implementação de utilitários de comunicação com
cache, message brokers e armazenamento temporário <em>in-memory</em> (Redis).
Deve ser importado principalmente no módulo de sessão.</li>
</ul>
<h2 id="módulos"><a class="header" href="#módulos">Módulos</a></h2>
<p>Os módulos planejados para o sistema são:</p>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
<code>minerva-user</code>: Servidor gRPC para CRUD de usuários. Deve ser capaz de
manipular as regras de negócios relacionadas a clientes.</li>
<li><input disabled="" type="checkbox"/>
<code>minerva-session</code>: Servidor gRPC para gerência de sessão de usuário.</li>
<li><input disabled="" type="checkbox"/>
<code>minerva-product</code>: Servidor gRPC para CRUD de produtos. Deve ser capaz
de manipular as regras de negócios relacionadas a produtos, mas que não
envolvam controle de estoque.</li>
<li><input disabled="" type="checkbox"/>
<code>minerva-stock</code>: Servidor gRPC para CRUD de estoque de produtos. Deve
ser capaz de manipular as regras de negócios relacionadas a estoque, mas
que não envolvam manipulação de produtos.</li>
<li><input disabled="" type="checkbox" checked=""/>
<code>minerva-rest</code>: Servidor REST para comunicação com os demais módulos
executáveis. Possui rotas que apontam para serviços específicos, e é por
definição um cliente gRPC de todos os servidores gRPC.</li>
<li><input disabled="" type="checkbox" checked=""/>
<code>minerva-runonce</code>: Serviço <strong>avulso</strong> para configuração do ambiente, de
forma assíncrona. Responsável pela execução de migrações do banco de dados
e outras operações de configuração inicial.</li>
<li><input disabled="" type="checkbox"/>
<code>minerva-report</code>: Servidor gRPC para geração de relatórios. Deve receber
dados com formatação esperada de um relatório, e então deverá gerar um
arquivo PDF e retorná-lo inteiramente como resposta.</li>
</ul>
<h2 id="portas"><a class="header" href="#portas">Portas</a></h2>
<p>Os serviços, independente de serem gRPC ou REST, devem ser executados em
certas portas padrão para evitarem conflitos durante o tempo de depuração.
Cada porta deve também ser configurável através de variáveis de ambiente.</p>
<p>A tabela a seguir discrimina as variáveis de ambiente e as portas padrão
de acordo com o serviço em questão.</p>
<table><thead><tr><th>Serviço</th><th>Variável</th><th>Valor</th></tr></thead><tbody>
<tr><td>USER</td><td><code>USER_SERVICE_PORT</code></td><td>9010</td></tr>
<tr><td>SESSION</td><td><code>SESSION_SERVICE_PORT</code></td><td>9011</td></tr>
<tr><td>PRODUCT</td><td><code>PRODUCT_SERVICE_PORT</code></td><td>9012</td></tr>
<tr><td>STOCK</td><td><code>STOCK_SERVICE_PORT</code></td><td>9013</td></tr>
<tr><td>REPORT</td><td><code>REPORT_SERVICE_PORT</code></td><td>9014</td></tr>
<tr><td>REST</td><td><code>ROCKET_PORT</code></td><td>9000</td></tr>
</tbody></table>
<p>No caso do serviço REST, verifique o arquivo <code>Rocket.toml</code> para avaliar
a configuração em desenvolvimento e em produção do mesmo.</p>
<h2 id="gateways"><a class="header" href="#gateways">Gateways</a></h2>
<p>Os serviços também podem operar em máquinas diferentes, dependendo de sua
rota.</p>
<p>Normalmente, quando todos os serviços são executados manualmente na mesma
máquina, operamos com uma rota <code>localhost</code>. Nesse caso, a variável de
ambiente de cada serviço é definida como esse valor.</p>
<p>Todavia, num ambiente de orquestração de contêineres (como Docker Compose
ou Kubernetes), cada serviço estará operando de forma separada, e poderá
comunicar-se com os outros serviços por intermédio de uma rede interna
ao qual apenas os serviços têm acesso de forma explícita. Assim, as
variáveis de ambiente que determinam o nome do servidor devem ser definidas
manualmente, de acordo com a forma como o deploy de cada serviço foi
realizado.</p>
<p>A seguir, temos uma tabela relacionando variáveis de ambiente com seus
devidos valores, que serão resolvidos através do DNS da rede interna criada
pelo orquestrador de contêineres.</p>
<p>No caso do serviço REST, verifique o arquivo <code>Rocket.toml</code> para avaliar
a configuração em desenvolvimento e em produção do mesmo.</p>
<table><thead><tr><th>Serviço</th><th>Variável</th><th>Valor em Produção</th></tr></thead><tbody>
<tr><td>USER</td><td><code>USER_SERVICE_SERVER</code></td><td><code>users</code></td></tr>
<tr><td>Banco de Dados</td><td><code>DATABASE_SERVICE_SERVER</code></td><td><code>postgresql</code></td></tr>
<tr><td>REST</td><td>nenhuma</td><td><code>rest</code></td></tr>
<tr><td>RUNONCE</td><td>nenhuma</td><td><code>runonce</code></td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multi-tenancy"><a class="header" href="#multi-tenancy">Multi-Tenancy</a></h1>
<p>O Minerva System é um sistema multi-tenant. Isso significa que é
capaz de gerenciar bancos de dados diferentes dependendo do tenant
(cliente do serviço) atual. No Minerva System, isso é gerenciado de
acordo com a forma como as requisições são recebidas.</p>
<h2 id="configuração"><a class="header" href="#configuração">Configuração</a></h2>
<p>Os tenants devem ser gerenciados através do arquivo <code>tenancy.toml</code>.</p>
<p>A seguir, um exemplo do conteúdo em potencial deste arquivo.</p>
<pre><code class="language-toml">[[tenants]]
name = &quot;Minerva System&quot;
database = &quot;minerva&quot;
connections = 5

[[tenants]]
name = &quot;Test Database&quot;
database = &quot;teste&quot;
connections = 5

[[tenants]]
name = &quot;Comercial Fulano S/A&quot;
database = &quot;comercial-fulano&quot;
connections = 5
</code></pre>
<h2 id="criação-do-banco-de-dados"><a class="header" href="#criação-do-banco-de-dados">Criação do banco de dados</a></h2>
<p>O serviço <code>RUNONCE</code> deverá executar a criação do banco de dados, caso
não seja possível conectar-se ao mesmo. Isso deve ser feito sobretudo
através da leitura do arquivo <code>tenancy.toml</code>, encontrado na pasta de
execução do projeto.</p>
<p>Caso um novo tenant seja adicionado ao sistema, o serviço <code>RUNONCE</code>
deverá ser forçadamente executado para que o sistema fique apto a
utilizar o banco de dados para aquele tenant.</p>
<p>O sistema <code>RUNONCE</code> deverá, para cada tenant listado em <code>tenancy.toml</code>:</p>
<ol>
<li>Tentar conectar-se ao banco em questão. Se isso não for possível,
deverá criá-lo;</li>
<li>Executar as migrations para aquele banco;</li>
<li>Criar o usuário <code>admin</code> para aquele banco.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="compilação"><a class="header" href="#compilação">Compilação</a></h1>
<p>Este capítulo fala a respeito das formas de compilação e <em>deploy</em>
do sistema.</p>
<p>Essas formas não são exaustivas, e os artigos a seguir devem ser
evoluídos à medida que o <em>deploy</em> for melhorado.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="compilando-e-executando-com-recursos-da-máquina"><a class="header" href="#compilando-e-executando-com-recursos-da-máquina">Compilando e executando com recursos da máquina</a></h1>
<p>Você pode compilar os módulos do sistema individualmente e executá-los
usando o próprio ambiente Rust.</p>
<h2 id="introdução-1"><a class="header" href="#introdução-1">Introdução</a></h2>
<p>Este artigo trata da situação mais comum durante o desenvolvimento das
partes do sistema, que envolve utilizá-las individualmente em um
ambiente de desenvolvimento.</p>
<p>O <em>deploy</em> usando Docker Compose e Kubernetes, enquanto possível em
ambiente de homologação e de testes manuais, utiliza muitos recursos
da máquina, e não é o ideal de ser utilizado enquanto o programador
estiver debugando a aplicação. Além disso, pela própria forma como
o sistema foi planejado, é possível executar porções individuais do
sistema em que haja interdependência entre elas.</p>
<h2 id="objetivo"><a class="header" href="#objetivo">Objetivo</a></h2>
<p>Compilar todos os módulos ou módulos individuais é muito importante do
ponto de vista do desenvolvimento. Neste artigo, tratamos de como isso
pode ser feito na máquina local de um desenvolvedor.</p>
<h2 id="dependências"><a class="header" href="#dependências">Dependências</a></h2>
<p>Você precisará de:</p>
<ul>
<li><a href="https://rustup.rs">Rust</a> (compilador <code>rustc</code> e gerenciador de
pacotes <code>cargo</code>, versão 1.60.0 ou superior);</li>
<li><a href="https://diesel.rs">Diesel</a> (versão 1.4.1 ou superior, com suporte
a PostgreSQL);</li>
<li><a href="https://flutter.dev">Flutter</a> (versão 3.0.0 ou superior, canal
<code>stable</code>. Apenas necessário o <em>target</em> de compilação para <code>web</code>);</li>
<li>Dart (versão 2.17.0 ou superior, canal <code>stable</code>);</li>
<li>Docker (versão 2.10 ou superior).</li>
</ul>
<p>O compilador Rust e o Docker são essenciais para compilar os módulos
individuais do <em>back-end</em> do projeto, enquanto o Flutter é importante
para a confecção do <em>front-end</em> da aplicação. Sendo assim, as
dependências podem ser instaladas de acordo com o bom-senso do
desenvolvedor.</p>
<p>O Diesel pode ser instalado através do gerenciador de pacotes <code>cargo</code>,
e sua instalação pode ser consultada em seu site, linkado acima. Além
disso, a linguagem Dart será instalada através do Flutter, de acordo
com as instruções que podem ser encontradas no site do mesmo.</p>
<h2 id="estrutura-do-projeto"><a class="header" href="#estrutura-do-projeto">Estrutura do projeto</a></h2>
<!-- workspaces com projetos individuais, etc -->
<p>O repositório do projeto é um <em>monorepo</em>, isto é, engloba todas as
partes do sistema inteiro. Por isso, as partes relacionadas a <em>back-end</em>
estão dispostas em um <em>Workspace</em>, configurável através das próprias
ferramentas do <code>cargo</code> e da linguagem Rust, enquanto o <em>front-end</em>
encontra-se unicamente no diretório <code>minerva_frontend</code>, e não faz
parte do <em>Workspace</em> em si.</p>
<h2 id="preparação-do-ambiente"><a class="header" href="#preparação-do-ambiente">Preparação do ambiente</a></h2>
<p>A primeira parte a ser executada deverá ser a preparação do ambiente.
Isso inclui a preparação de quaisquer serviços ou bancos de dados
externos que possam ser importantes para a execução da aplicação.</p>
<p>No Sistema Minerva, o serviço <code>RUNONCE</code> é responsável por executar
essas operações, sendo também o serviço que executa <em>migrations</em> no
banco de dados, por exemplo.</p>
<p>Para tanto, precisaremos compilar este módulo específico antes de
qualquer outro. Isso será melhor delineado na seção sobre compilação
do <em>back-end</em>, mas realizaremos uma configuração rápida nesta seção.</p>
<h3 id="criando-o-banco-de-dados"><a class="header" href="#criando-o-banco-de-dados">Criando o banco de dados</a></h3>
<p>Como primeira dependência, recomenda-se criar o banco de dados via
Docker. Também seria possível instalar o PostgreSQL 14 na máquina local,
mas o Docker provê a comodidade necessária para o BD.</p>
<p>O diretório <code>minerva-runonce</code> possui um script que pode ser executado
para a criação do banco de dados. Este script executa o seguinte
comando:</p>
<pre><code class="language-bash">docker run --name minerva-micro \
       -e POSTGRES_USER=postgres \
       -e POSTGRES_PASSWORD=postgres \
       -p 5432:5432 \
       -d postgres:14
</code></pre>
<p>Este comando criará um contêiner chamado <code>minerva-micro</code>, a partir
da imagem Docker do PostgreSQL 14, com usuário e senhas padrão
<code>postgres</code>, e também servindo na porta <code>5432</code> da máquina atual (padrão
do PostgreSQL).</p>
<p>É importante lembrar que <strong>usar o contêiner dessa forma não é muito
seguro para persistência de dados</strong>. Por isso, <strong>pense neste contêiner
como um banco de dados de um ambiente exclusivo de testes.</strong></p>
<p>Caso você precise encerrar o contêiner, use:</p>
<pre><code class="language-bash">docker stop minerva-micro
</code></pre>
<p>Da mesma forma, não será necessário executar novamente o <code>RUNONCE</code> para
configuração, a não ser que o schema do banco de dados seja alterado.
Nesse caso, cada vez que for necessário reutilizar o banco para testes,
use o comando a seguir para reiniciar o BD:</p>
<pre><code class="language-bash">docker start minerva-micro
</code></pre>
<h3 id="executando-configuração-inicial-módulo-runonce"><a class="header" href="#executando-configuração-inicial-módulo-runonce">Executando configuração inicial (módulo <code>RUNONCE</code>)</a></h3>
<p>A seguir, execute o módulo <code>RUNONCE</code> para preparar todos os bancos de
dados de <em>tenants</em>, executar as migrations e criar o usuário <code>admin</code>
em cada banco.</p>
<p>Você poderá executar o módulo diretamente a partir da raiz do projeto:</p>
<pre><code class="language-bash">cargo run --bin minerva-runonce
</code></pre>
<p>Caso haja algum problema com o comando anterior (por exemplo, se o
módulo não encontrar o diretório <code>migrations</code>), vá para o diretório do
módulo e execute-o:</p>
<pre><code class="language-bash">cd minerva-runonce
cargo run
</code></pre>
<p>Após a compilação do módulo <code>RUNONCE</code>, o mesmo aguardará o banco de
dados estar pronto para receber as conexões e aplicará as migrations.</p>
<h2 id="compilação-back-end"><a class="header" href="#compilação-back-end">Compilação (<em>Back-end</em>)</a></h2>
<p>Você poderá compilar todos os módulos do projeto de uma só vez, ou
compilar apenas os módulos necessários.</p>
<h3 id="compilando-todos-os-módulos"><a class="header" href="#compilando-todos-os-módulos">Compilando todos os módulos</a></h3>
<p>Para compilar todos os módulos, vá para a raiz do projeto e execute
um comando de compilação para todo o workspace:</p>
<pre><code class="language-bash">cargo build
</code></pre>
<p>De forma similar, você poderá compilar o projeto para produção através
da <em>flag</em> <code>--release</code>:</p>
<pre><code class="language-bash">cargo build --release
</code></pre>
<h3 id="compilando-um-módulo-específico"><a class="header" href="#compilando-um-módulo-específico">Compilando um módulo específico</a></h3>
<p>Existem duas formas de compilar um módulo específico: a partir do
<em>workspace</em> (diretório raiz do repositório) ou a partir do diretório
do módulo específico.</p>
<p>Qualquer módulo pode ser compilado a partir do diretório raiz com um
comando como o mostrado a seguir (substitua <code>&lt;módulo&gt;</code> pelo nome do
diretório do módulo em questão):</p>
<pre><code class="language-bash">cargo build --bin &lt;módulo&gt;
</code></pre>
<p>Isto compilará qualquer módulo que faça parte do <em>workspace</em>, exceto
bibliotecas auxiliares (como <code>minerva-rpc</code>, <code>minerva-data</code> e
<code>minerva-cache</code>) e o <em>front-end</em> (contido em <code>minerva_frontend</code>).</p>
<p>Da mesma forma, você também poderá ir ao diretório do módulo específico
e compilá-lo diretamente; neste caso, a compilação também funcionará
para bibliotecas auxiliares.</p>
<pre><code class="language-bash">cd &lt;módulo&gt;
cargo build
</code></pre>
<p>De forma similar à compilação geral, ambos os comandos também admitem
a <em>flag</em> <code>--release</code> para compilar os módulos para produção.</p>
<h3 id="execução"><a class="header" href="#execução">Execução</a></h3>
<p>É possível executar diretamente um módulo qualquer através do <code>cargo</code>,
o que também implica na sua compilação.</p>
<p>Para executar a partir do diretório do <em>workspace</em> (apenas para
módulos que geram executáveis):</p>
<pre><code class="language-bash">cargo run --bin &lt;módulo&gt;
</code></pre>
<p>Para executar a partir do diretório do módulo em questão:</p>
<pre><code class="language-bash">cd &lt;módulo&gt;
cargo run
</code></pre>
<p>Da mesma forma, é possível compilar e executar os módulos no modo
de produção através da <em>flag</em> <code>--release</code>.</p>
<h3 id="testes"><a class="header" href="#testes">Testes</a></h3>
<p>Para executar testes unitários e integração, basta seguir um processo
similar à execução dos módulos. Testes com binários compilados para
produção podem ser igualmente controlados pela <em>flag</em> <code>--release</code>.</p>
<p>Para executar quaisquer testes, é necessário <strong>garantir</strong> que o
banco de dados esteja acessível e adequadamente configurado.</p>
<pre><code class="language-bash"># Para testar todos os módulos do workspace
cargo test

# Para testar apenas um módulo do workspace
cargo test --bin &lt;módulo&gt;

# Para testar apenas um módulo em seu diretório
cd &lt;módulo&gt;
cargo test
</code></pre>
<h2 id="compilação-front-end"><a class="header" href="#compilação-front-end">Compilação (<em>Front-end</em>)</a></h2>
<p>O front-end é um módulo separado do restante dos módulos, sendo o
sistema que envolve a interface gráfica do Sistema Minerva.</p>
<h3 id="executando-o-projeto-via-console"><a class="header" href="#executando-o-projeto-via-console">Executando o projeto via console</a></h3>
<p>Para executar o projeto via console, basta usar a ferramenta de linha
de comando do Flutter.</p>
<h4 id="preparando-o-flutter"><a class="header" href="#preparando-o-flutter">Preparando o Flutter</a></h4>
<p>Antes de mais nada, garanta que o Flutter esteja configurado para
compilar projetos Web:</p>
<pre><code class="language-bash">flutter config --enable-web
</code></pre>
<p>Além disso, o Google Chrome deverá estar disponível para ser utilizado
no debug. O estado do ambiente Flutter pode ser verificado com o
comando <code>flutter doctor</code>.</p>
<p>Caso haja alguma inconsistência no seu ambiente, veja a seção de
<a href="https://docs.flutter.dev/get-started/web">preparação do Flutter para Web</a>
na documentação oficial.</p>
<h4 id="executando-o-projeto"><a class="header" href="#executando-o-projeto">Executando o projeto</a></h4>
<p>Para executar o projeto, vá até o diretório do módulo de <em>front-end</em>,
baixe as dependências necessárias, e então execute o projeto no Google
Chrome:</p>
<pre><code class="language-bash">cd minerva_frontend
flutter pub get
flutter run -d chrome
</code></pre>
<h3 id="compilando-para-produção"><a class="header" href="#compilando-para-produção">Compilando para produção</a></h3>
<p>Para compilar o projeto para produção, vá até a pasta do módulo e
execute os comandos a seguir. Eles baixarão as dependências faltantes
(caso já não tenham sido baixadas) e gerarão os arquivos estáticos
da aplicação.</p>
<pre><code class="language-bash">cd minerva_frontend
flutter pub get
flutter build web
</code></pre>
<p>Você poderá encontrar a versão compilada da aplicação <em>front-end</em> no
diretório <code>minerva_frontend/build/web</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deploy-usando-docker-compose"><a class="header" href="#deploy-usando-docker-compose">Deploy usando Docker Compose</a></h1>
<p><img src="./docker-compose.png" alt="Docker Compose" /></p>
<p>Você pode realizar deploy do projeto usando Docker Compose. Todavia,
esta não é a forma mais recomendada de realização de deploy.</p>
<h2 id="introdução-2"><a class="header" href="#introdução-2">Introdução</a></h2>
<p>Docker Compose é uma ferramenta simples de orquestração de contêineres.
Para o Minerva System, é principalmente uma forma de <strong>testar</strong> a forma
como o serviço se comporta em rede.</p>
<h2 id="objetivo-1"><a class="header" href="#objetivo-1">Objetivo</a></h2>
<p>O deploy usando Docker Compose é útil principalmente do ponto de vista
da geração das imagens das aplicações dos microsserviços do Minerva
System, mas também não é a forma mais recomendada de colocar o sistema
em produção, porque não prevê fatores de escalabilidade como o deploy
usando Kubernetes.</p>
<p>Utilize esta forma principalmente quando quiser avaliar o comportamento
do sistema no que tange a interconexões entre os serviços numa rede
virtual.</p>
<h2 id="dependências-1"><a class="header" href="#dependências-1">Dependências</a></h2>
<p>Você precisará ter instalado:</p>
<ul>
<li>Docker versão 20.10 ou superior;</li>
<li>Docker Compose versão 2.2.3 ou superior.</li>
</ul>
<p>Além disso, <strong>todos os comandos a seguir devem ser executados no
diretório raiz deste projeto</strong>.</p>
<h2 id="gerando-imagens"><a class="header" href="#gerando-imagens">Gerando imagens</a></h2>
<p>Caso você só precise gerar as imagens Docker para o serviço, você
poderá fazê-lo com o comando a seguir:</p>
<pre><code class="language-bash">docker compose build
</code></pre>
<p>Se você nunca tiver realizado deploy da aplicação com Compose, isto
<strong>não é necessário</strong>, uma vez que o Compose se encarregará de gerá-las
no primeiro deploy.</p>
<p><strong>ATENÇÃO: O PROCESSO DE GERAÇÃO DAS IMAGENS É DEMORADO.</strong></p>
<h3 id="gerando-uma-imagem"><a class="header" href="#gerando-uma-imagem">Gerando uma imagem</a></h3>
<p>Pode ocorrer de você querer gerar apenas uma imagem, por exemplo, quando
você já tiver realizado deploy antes e tiver realizado uma modificação
em apenas um microsservico, e precisar testá-lo.</p>
<p>Para isso, use o comando a seguir, substituindo <code>&lt;servico&gt;</code> pelo nome
do serviço (como listado no arquivo <code>docker-compose.yml</code>):</p>
<pre><code class="language-bash">docker compose build &lt;servico&gt;
</code></pre>
<p>Caso a geração da imagem apenas reutilize o cache da mesma já existente,
você poderá forçar a geração da imagem da seguinte forma:</p>
<pre><code class="language-bash">docker compose build --no-cache &lt;servico&gt;
</code></pre>
<p><strong>ATENÇÃO: ESTE PROCESSO PODE SER DEMORADO.</strong></p>
<p><strong>ATENÇÃO: RECOMPILAR A IMAGEM NÃO REINICIA UM SERVIÇO EM EXECUÇÃO.</strong></p>
<h3 id="nomes-e-tags-das-imagens-geradas"><a class="header" href="#nomes-e-tags-das-imagens-geradas">Nomes e tags das imagens geradas</a></h3>
<p>As imagens geradas pelos passos anteriores são geradas com nomes
específicos. Esses nomes não fazem tanta diferença para o Docker
Compose, mas podem ser muito úteis do ponto de vista do deploy via
Kubernetes.</p>
<p>Os nomes das imagens geradas podem ser verificados no arquivo
<code>docker-compose.yml</code>. Mais especificamente, para cada serviço, existe
uma propriedade <code>image</code> que determina o nome da imagem gerada.</p>
<p>As imagens são sempre geradas com a tag <code>latest</code>.</p>
<p>A seguir, temos uma tabela relacionando os serviços com os nomes e tags
das imagens geradas.</p>
<table><thead><tr><th>Serviço</th><th>Nome e tag da imagem</th></tr></thead><tbody>
<tr><td><code>frontend</code></td><td><code>minerva_frontend:latest</code></td></tr>
<tr><td><code>rest</code></td><td><code>minerva_rest:latest</code></td></tr>
<tr><td><code>runonce</code></td><td><code>minerva_runonce:latest</code></td></tr>
<tr><td><code>users</code></td><td><code>minerva_users:latest</code></td></tr>
<tr><td><code>postgresql</code></td><td><code>postgres:14</code> (Não gerado)</td></tr>
<tr><td><code>pgadmin</code></td><td><code>minerva_pgadmin:latest</code></td></tr>
</tbody></table>
<h2 id="executando-os-serviços"><a class="header" href="#executando-os-serviços">Executando os serviços</a></h2>
<p>Para executar os serviços usando Docker Compose, use o seguinte
comando:</p>
<pre><code class="language-bash">docker compose up
</code></pre>
<p>Caso você queira desligar o funcionamento dos serviços da sessão
atual do console, poderá executá-los em forma de <em>daemon</em>:</p>
<pre><code class="language-bash">docker compose up -d
</code></pre>
<p>Neste caso em específico, para <code>localhost</code>, estarão abertas as
seguintes portas para acesso:</p>
<table><thead><tr><th>Porta</th><th>Serviço</th></tr></thead><tbody>
<tr><td><code>80</code></td><td>Front-End</td></tr>
<tr><td><code>9000</code></td><td>API REST</td></tr>
<tr><td><code>8484</code></td><td>pgAdmin4</td></tr>
</tbody></table>
<h2 id="acompanhando-logs"><a class="header" href="#acompanhando-logs">Acompanhando logs</a></h2>
<p>Para acompanhar os logs de um deploy via <em>daemon</em> ou de um outro
console, você poderá realizá-lo através do comando:</p>
<pre><code class="language-bash">docker compose logs -f
</code></pre>
<p>Caso seja necessário acompanhar os logs de apenas um serviço:</p>
<pre><code class="language-bash">docker compose logs -f &lt;servico&gt;
</code></pre>
<p>Lembre-se de que o nome do serviço em questão deverá ser informado
como listado em <code>docker-compose.yml</code>.</p>
<h3 id="reiniciando-um-único-serviço"><a class="header" href="#reiniciando-um-único-serviço">Reiniciando um único serviço</a></h3>
<p>Você poderá reiniciar um único serviço, caso tenha recompilado a imagem
do mesmo, por exemplo.</p>
<p>Nesse caso, basta usar o seguinte comando:</p>
<pre><code class="language-bash">docker compose up -d --no-deps &lt;servico&gt;
</code></pre>
<p>Caso você queira incluir o passo de recompilação da imagem:</p>
<pre><code class="language-bash">docker compose up -d --no-deps --build &lt;servico&gt;
</code></pre>
<h2 id="encerrando-os-serviços"><a class="header" href="#encerrando-os-serviços">Encerrando os serviços</a></h2>
<p>Para encerrar imediatamente o serviço, execute o seguinte comando:</p>
<pre><code class="language-bash">docker compose down
</code></pre>
<p>Caso você queira também remover os volumes associados aos serviços
(por exemplo, nocaso do PostgreSQL e do pgAdmin), use este comando
em vez do anterior:</p>
<pre><code class="language-bash">docker compose -v down
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deploy-usando-kubernetes-e-minikube"><a class="header" href="#deploy-usando-kubernetes-e-minikube">Deploy usando Kubernetes (e Minikube)</a></h1>
<p><img src="./kubernetes-logo.webp" alt="Kubernetes" /></p>
<p>Você pode realizar deploy do projeto usando Kubernetes. Nos passos a
seguir, será mostrado como realizar um deploy usando a ferramenta
Minikube, para instalação do Kubernetes localmente.</p>
<p><strong>ATENÇÃO:</strong> Para detalhes não dispostos nesta página, veja a
<a href="https://kubernetes.io/docs/home/">documentação oficial do Kubernetes</a>.</p>
<h2 id="introdução-3"><a class="header" href="#introdução-3">Introdução</a></h2>
<p>Kubernetes é uma ferramenta sofisticada de orquestração de contêineres.
O Minerva System é planejado para que seu deploy seja feito utilizando
o Kubernetes.</p>
<p>Para realizar a configuração localmente, fui utilizada a ferramenta
Minikube. Portanto, os comandos aqui abordados partem do pressuposto
de uma instalação local do Kubernetes via Minikube, e podem ser </p>
<h2 id="objetivo-2"><a class="header" href="#objetivo-2">Objetivo</a></h2>
<p>O deploy usando Kubernetes é planejado desde o início do projeto, sendo
uma das formas de estado da arte de deploy de aplicações web. Para
simular este cenário, utilizamos uma instalação local do Kubernetes
via Minikube.</p>
<p>Ainda que Minikube não seja exatamente um servidor do Kubernetes em
produção, boa parte do que será aqui discutido poderá ser utilizado
no momento do deploy para produção.</p>
<h2 id="dependências-2"><a class="header" href="#dependências-2">Dependências</a></h2>
<p>Você precisará ter instalado:</p>
<ul>
<li>Docker versão 20.10 ou superior;</li>
<li>Docker Compose versão 2.2.3 ou superior;</li>
<li>Kubectl versão 1.23.3 ou superior;</li>
<li><a href="https://minikube.sigs.k8s.io/docs/">Minikube</a> versão 1.24.0 ou
superior;</li>
<li><a href="k9scli.io">k9s</a> versão 0.25.18 ou superior (opcional).</li>
</ul>
<p>A instalação do k9s é opcional, sendo uma ferramenta de monitoramento
e gerencialmento do Kubernetes via linha de comando.</p>
<h3 id="iniciando-o-minikube"><a class="header" href="#iniciando-o-minikube">Iniciando o Minikube</a></h3>
<p>Caso você esteja testando localmente, comece executando o Minikube.</p>
<pre><code class="language-bash">minikube start
</code></pre>
<p>Se você quiser parar o Minikube:</p>
<pre><code class="language-bash">minikube stop
</code></pre>
<p>Você também pode acessar facilmente um dashboard web do Kubernetes,
operando sob o Minikube, caso não queira usar o k9s posteriormente:</p>
<pre><code class="language-bash">minikube dashbord
</code></pre>
<h2 id="geração-das-imagens"><a class="header" href="#geração-das-imagens">Geração das imagens</a></h2>
<p>Antes de realizar deploy, é preciso gerar as imagens de cada um dos
serviços. No caso específico do Minikube, é preciso também que essas
imagens localmente construídas sejam carregadas para dentro deste
serviço.</p>
<h3 id="gerando-imagens-com-docker-compose"><a class="header" href="#gerando-imagens-com-docker-compose">Gerando imagens com Docker Compose</a></h3>
<p>Você poderá gerar as imagens dos serviços usando a própria
infraestrutura de geração de imagens do Docker Compose, o que é
recomendado. Para tanto, veja a seção
<a href="./deploy-compose.html#gerando-imagens">geração das imagens</a>
na página de configuração do Docker Compose.</p>
<p>Esse passo é essencial para serviços e jobs marcados com
<code>imagePullPolicy</code> igual a <code>Never</code>.</p>
<h3 id="compartilhando-as-imagens-com-o-minikube"><a class="header" href="#compartilhando-as-imagens-com-o-minikube">Compartilhando as imagens com o Minikube</a></h3>
<p>Caso você esteja utilizando o Minikube, precisará carregar as
imagens no ambiente do mesmo, do contrário ainda terá erros
relacionados ao <code>imagePullPolicy</code>. Isso pode ser feito com um
comando como mostrado a seguir:</p>
<pre><code class="language-bash">minikube image load &lt;nome-imagem&gt;:&lt;tag&gt;
</code></pre>
<p>Por exemplo, para carregar a imagem do Front-End, use o comando
<code>minikube image load minerva_frontend:latest</code>.</p>
<p>Você poderá também informar mais de uma imagem de uma só vez,
por exemplo:</p>
<pre><code class="language-bash">minikube image load \
	 minerva_rest:latest \
	 minerva_frontend:latest \
	 minerva_pgadmin:latest \
	 minerva_users:latest \
	 minerva_runonce:latest
</code></pre>
<h2 id="disposição-da-configuração"><a class="header" href="#disposição-da-configuração">Disposição da configuração</a></h2>
<p>A configuração do Sistema Minerva para Kubernetes foi originalmente
produzida através de conversão direta da configuração do Docker
Compose, mais especificamente através da ferramenta
<a href="https://kompose.io">Kompose</a>, e então modificada para suprir algumas
necessidades do sistema.</p>
<p>De forma geral, no Kubernetes, temos que:</p>
<ul>
<li>Um <strong>node</strong> refere-se a uma instalação do Kubernetes em uma máquina.</li>
<li>Um <strong>pod</strong> é um grupo de um ou mais contêineres, que compartilha
armazenamento e recursos de rede.</li>
<li>Um <strong>deployment</strong> é a descrição de um <em>pod</em>, mais especificamente
o seu comportamento e suas características. Também pode ser usado
para gerenciar réplicas de <em>pods</em> (ou <em>ReplicaSets</em>).</li>
<li>Um <strong>service</strong> é uma configuração de acessibilidade para os <em>pods</em>,
mais especificamente agindo como uma forma de localizá-los na rede.
Em outras palavras, age como um gerenciador de DNS.</li>
</ul>
<p>Os arquivos de configuração do Kubernetes estão desmembrados em suas
devidas partes, seguindo ligeiramente o âmbito dos <em>services</em> e dos
<em>deployments</em>, exceto quando não aplicável, e podem ser encontrados
no diretório <code>build/kubernetes</code>.</p>
<p>Assim, temos a seguinte configuração de serviços:</p>
<table><thead><tr><th>Serviço</th><th>Tipo</th><th>Réplicas padrão</th></tr></thead><tbody>
<tr><td><code>frontend</code></td><td><em>LoadBalancer</em></td><td>2</td></tr>
<tr><td><code>pgadmin</code></td><td><em>LoadBalancer</em></td><td>1</td></tr>
<tr><td><code>rest</code></td><td><em>LoadBalancer</em></td><td>3</td></tr>
<tr><td><code>runonce</code></td><td><em>Job</em></td><td><strong>Sempre 1</strong></td></tr>
<tr><td><code>users</code></td><td><em>ClusterIP</em></td><td>3</td></tr>
<tr><td><code>postgresql</code></td><td><em>ClusterIP</em></td><td><strong>Sempre 1</strong></td></tr>
</tbody></table>
<p>Devemos considerar também, sobre os tipos dos serviços:</p>
<ul>
<li>Serviços <em>LoadBalancer</em> são acessíveis via IP externo.</li>
<li><em>Jobs</em> são executados no início da configuração do <em>node</em>.</li>
<li>Serviços <em>ClusterIP</em> são acessíveis apenas na rede interna do <em>node</em>.</li>
</ul>
<h2 id="executando-e-gerenciando-o-cluster"><a class="header" href="#executando-e-gerenciando-o-cluster">Executando e gerenciando o cluster</a></h2>
<p>Para iniciar a configuração, posto que as imagens dos serviços
estejam à disposição do Kubernetes (ou do Minikube), vá até o diretório
raiz do projeto e execute:</p>
<pre><code class="language-bash">kubectl create -f build/kubernetes
</code></pre>
<p>Isso criará o <em>node</em> com base em todos os arquivos <code>.yaml</code> existentes
no diretório <code>build/kubernetes</code>.</p>
<p>Caso você realize alguma alteração nos arquivos e queira aplicá-las,
utilize:</p>
<pre><code class="language-bash">kubectl apply -f build/kubernetes
</code></pre>
<p>Da mesma forma, é possível aplicar as alterações de um único arquivo.
Por exemplo:</p>
<pre><code class="language-bash">kubectl apply -f build/kubernetes/rest-deployment.yaml
</code></pre>
<p>Caso você queira deletar o cluster posteriormente, utilize o comando
similar no mesmo diretório:</p>
<pre><code class="language-bash">kubectl delete -f build/kubernetes
</code></pre>
<h3 id="monitorando-via-k9s"><a class="header" href="#monitorando-via-k9s">Monitorando via k9s</a></h3>
<p><img src="./k9s.png" alt="k9s" /></p>
<p>Uma das ferramentas possíveis de se utilizar para monitorar o cluster
é o <code>k9s</code>.</p>
<p>A ferramenta utiliza uma edição modal, muito parecida com o editor
Vim. Os comandos possuem um sistema de autocompletar e são também
mostrados na tela. Alguns comandos interessantes de serem utilizados
são:</p>
<ul>
<li><code>:q</code>: Sair da aplicação.</li>
<li><code>:po</code>: Lista de <em>pods</em>.</li>
<li><code>:svc</code>: Lista de <em>services</em>.</li>
<li><code>:deployment</code>: Lista de <em>deployments</em>.</li>
</ul>
<p>Você poderá usar o <code>k9s</code> para visualizar logs e também para modificar
algumas propriedades mais avançadas também.</p>
<h3 id="logs"><a class="header" href="#logs">Logs</a></h3>
<p>Para visualizar logs completos de cada <em>pod</em>, primeiramente descubra
o nome do <em>pod</em> que você deseja observar:</p>
<pre><code class="language-bash">kubectl get pods
</code></pre>
<p>Um exemplo da saída deste comando poderia ser:</p>
<pre><code class="language-text">NAME                          READY   STATUS      RESTARTS   AGE
frontend-86c7955bdc-7zv4g     1/1     Running     0          43m
pgadmin-76c5d7ccf7-4wk7g      1/1     Running     0          43m
postgresql-6f8b685668-94qbs   1/1     Running     0          43m
rest-57f984cb4c-25s9h         1/1     Running     0          42m
runonce--1-kl4rb              0/1     Completed   0          43m
users-549f5775c4-8fh9x        1/1     Running     0          42m
</code></pre>
<p>Para ver os logs completos da execução atual de um pod qualquer,
use o nome completo do <em>pod</em>, como mostrado acima:</p>
<pre><code class="language-bash">kubectl logs runonce--1-kl4rb
</code></pre>
<p>Caso o <em>pod</em> não tenha sido encerrado corretamente da última vez,
você poderá ver os logs anteriores com a flag <code>--previous</code>:</p>
<pre><code class="language-bash">kubectl logs --previous runonce--1-kl4rb
</code></pre>
<h2 id="acessando-serviços-com-minikube"><a class="header" href="#acessando-serviços-com-minikube">Acessando serviços com Minikube</a></h2>
<p>Há duas formas de acessar serviços pelo Minikube: através de
<em>NodePort</em> e de <em>LoadBalancer</em>. Este último envolve a ideia
de <em>tunelamento</em> via Minikube.</p>
<h3 id="acessando-via-nodeport"><a class="header" href="#acessando-via-nodeport">Acessando via <em>NodePort</em></a></h3>
<p>Caso você queira descobrir o endereço para um serviço de tipo
<em>LoadBalancer</em>, você poderá descobrir o IP usando o Minikube.
Este método basicamente utiliza a ideia de <em>NodePort</em> para
redirecionar o tráfego para a aplicação:</p>
<pre><code class="language-bash">minikube service rest --url
</code></pre>
<p>Supondo que este comando retorne um valor para o serviço <code>rest</code> como
<code>http://192.168.49.2:30617</code>, agora será possível fazer uma requisição
REST comum diretamente neste endereço:</p>
<pre><code class="language-bash">curl http://192.168.49.2:30617/minerva/users
</code></pre>
<pre><code class="language-text">[{&quot;id&quot;:1,&quot;login&quot;:&quot;admin&quot;,&quot;name&quot;:&quot;Administrator&quot;,&quot;email&quot;:null}]
</code></pre>
<h3 id="acessando-via-loadbalancer"><a class="header" href="#acessando-via-loadbalancer">Acessando via <em>LoadBalancer</em></a></h3>
<p>Primeiramente, caso você esteja executando o Minikube, abra um terminal
avulso (que terá a execução bloqueada pelo próximo comando) e digite:</p>
<pre><code class="language-bash">minikube tunnel
</code></pre>
<p><strong>Note que este comando pode exigir a senha do seu usuáio.</strong></p>
<p>Isso fará com que todos os nós do tipo <em>LoadBalancer</em> recebem IPs externos
que podem ser acessados imediatamente. Para verificar esses IPs externos,
verifique os serviços ativos (isso também pode ser observado pelo k9s):</p>
<pre><code class="language-bash">kubectl get svc
</code></pre>
<p>Um exemplo de saída do comando:</p>
<pre><code class="language-text">NAME         TYPE           CLUSTER-IP       EXTERNAL-IP      PORT(S)          AGE
frontend     LoadBalancer   10.108.114.123   10.108.114.123   80:32613/TCP     31m
kubernetes   ClusterIP      10.96.0.1        &lt;none&gt;           443/TCP          8h
pgadmin      LoadBalancer   10.99.60.133     10.99.60.133     8484:30065/TCP   31m
postgresql   ClusterIP      10.99.167.49     &lt;none&gt;           5432/TCP         31m
rest         LoadBalancer   10.111.150.132   10.111.150.132   9000:31522/TCP   31m
users        ClusterIP      10.97.99.55      &lt;none&gt;           9010/TCP         31m
</code></pre>
<p>No caso acima, podemos verificar, por exemplo, que requisições REST devem ser
direcionadas para o caminho <code>http://10.111.150.132:9000</code>, como observado pelas
colunas <code>EXTERNAL-IP</code> e <code>PORT(S)</code>.</p>
<p>Portanto:</p>
<pre><code class="language-bash">curl http://10.111.150.132:9000/minerva/users
</code></pre>
<pre><code class="language-text">[{&quot;id&quot;:1,&quot;login&quot;:&quot;admin&quot;,&quot;name&quot;:&quot;Administrator&quot;,&quot;email&quot;:null}]
</code></pre>
<p>Caso haja portas pendentes de clientes de tunelamento do Minikube que não tenham
sido liberadas, você poderá liberar as portas manualmente com:</p>
<pre><code class="language-bash">minikube tunnel --cleanup
</code></pre>
<h2 id="escalando-deployments"><a class="header" href="#escalando-deployments">Escalando <em>deployments</em></a></h2>
<p>Quando for necessário prover redundância em certos recursos do Kubernetes, poderemos
escalar horizontalmente um ou mais <em>deployments</em>, criando <em>ReplicaSets</em> para os
mesmos.</p>
<p>Para tanto, use um comando como o mostrado a seguir, definindo o número de
<em>ReplicaSets</em>:</p>
<pre><code class="language-bash">kubectl scale deployment/&lt;nome-do-deployment&gt; --replicas=1
</code></pre>
<p>Note que introduzir um número de zero réplicas efetivamente eliminará todos os
<em>pods</em> do <em>deployment</em>, até que as réplicas sejam definidas novamente.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
